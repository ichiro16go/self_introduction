{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/dev/winc/self-introduction-card/src/app/api/generate-card/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\";\nimport { createCanvas } from \"canvas\";\n// import { readFileSync } from \"fs\";\nimport { join } from \"path\";\nimport { registerFont } from \"canvas\";\n\nconst fontPath = join(process.cwd(), \"public/fonts/NotoSansJP-Regular.ttf\");\nregisterFont(fontPath, { family: \"Noto Sans JP\" });\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n\n    const data = {\n      name: formData.get(\"name\") as string,\n      birthMonth: formData.get(\"birthMonth\") as string,\n      birthDay: formData.get(\"birthDay\") as string,\n      department: formData.get(\"department\") as string,\n      grade: formData.get(\"grade\") as string,\n      hometown: formData.get(\"hometown\") as string,\n      mbti: formData.get(\"mbti\") as string,\n      recentBoom: formData.get(\"recentBoom\") as string,\n      skill: formData.get(\"skill\") as string,\n      part: formData.get(\"part\") as string,\n      recentNews: formData.get(\"recentNews\") as string,\n      favoriteBand: formData.get(\"favoriteBand\") as string,\n      rankingLabel: formData.get(\"rankingLabel\") as string,\n      ranking1: formData.get(\"ranking1\") as string,\n      ranking2: formData.get(\"ranking2\") as string,\n      ranking3: formData.get(\"ranking3\") as string,\n      comment: formData.get(\"comment\") as string,\n      // font: formData.get(\"font\") as string,\n      color: formData.get(\"color\") as string,\n    };\n\n    // フォームデータから画像を取得\n    const imageFile = formData.get(\"image\") as File | null;\n    let uploadedImage = null;\n\n    if (imageFile && imageFile.size > 0) {\n      const imageBuffer = Buffer.from(await imageFile.arrayBuffer());\n      const { loadImage } = await import(\"canvas\");\n      uploadedImage = await loadImage(imageBuffer);\n    }\n\n    // Canvas作成\n    const canvas = createCanvas(600, 800);\n    const ctx = canvas.getContext(\"2d\");\n\n    // 背景グラデーション設定\n    const colorMap: Record<string, { colors: [string, string] }> = {\n      pink: { colors: [\"#fce7f3\", \"#fed7aa\"] },\n      blue: { colors: [\"#dbeafe\", \"#a7f3d0\"] },\n      green: { colors: [\"#dcfce7\", \"#a7f3d0\"] },\n      purple: { colors: [\"#e9d5ff\", \"#fce7f3\"] },\n      yellow: { colors: [\"#fef3c7\", \"#fed7aa\"] },\n    };\n\n    const selectedColor = colorMap[data.color] || colorMap.pink;\n\n    // グラデーション背景\n    const gradient = ctx.createLinearGradient(0, 0, 600, 800);\n    gradient.addColorStop(0, selectedColor.colors[0]);\n    gradient.addColorStop(1, selectedColor.colors[1]);\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, 600, 800);\n\n    // 左側に画像を描画\n    if (uploadedImage) {\n      const imageWidth = 280;\n      const imageHeight = 350;\n      const imageX = 30;\n      const imageY = 80;\n\n      // 画像を角丸で描画\n      ctx.save();\n      roundRect(imageX, imageY, imageWidth, imageHeight, 12);\n      ctx.clip();\n\n      // アスペクト比を保持して画像を描画\n      const aspectRatio = uploadedImage.width / uploadedImage.height;\n      let drawWidth = imageWidth;\n      let drawHeight = imageHeight;\n      let drawX = imageX;\n      let drawY = imageY;\n\n      if (aspectRatio > imageWidth / imageHeight) {\n        drawHeight = imageWidth / aspectRatio;\n        drawY = imageY + (imageHeight - drawHeight) / 2;\n      } else {\n        drawWidth = imageHeight * aspectRatio;\n        drawX = imageX + (imageWidth - drawWidth) / 2;\n      }\n\n      ctx.drawImage(uploadedImage, drawX, drawY, drawWidth, drawHeight);\n      ctx.restore();\n    }\n\n    // 角丸四角形を描画する関数\n    // 角丸四角形を描画する関数\n    function roundRect(x: number, y: number, width: number, height: number, radius: number) {\n      ctx.beginPath()\n      ctx.moveTo(x + radius, y)\n      ctx.lineTo(x + width - radius, y)\n      ctx.quadraticCurveTo(x + width, y, x + width, y + radius)\n      ctx.lineTo(x + width, y + height - radius)\n      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height)\n      ctx.lineTo(x + radius, y + height)\n      ctx.quadraticCurveTo(x, y + height, x, y + height - radius)\n      ctx.lineTo(x, y + radius)\n      ctx.quadraticCurveTo(x, y, x + radius, y)\n      ctx.closePath()\n    }\n\n    // テキストを描画する関数\n    function drawText(\n      text: string,\n      x: number,\n      y: number,\n      fontSize: number,\n      color = \"#1f2937\",\n      maxWidth?: number\n    ) {\n      ctx.fillStyle = color;\n      ctx.font = `${fontSize}px \"Noto Sans JP\"`;\n      if (maxWidth) {\n        ctx.fillText(text, x, y, maxWidth);\n      } else {\n        ctx.fillText(text, x, y);\n      }\n    }\n\n    // ラベル付きボックスを描画する関数\n    function drawLabeledBox(\n      x: number,\n      y: number,\n      width: number,\n      height: number,\n      label: string,\n      value: string\n    ) {\n      // 白い背景\n      ctx.fillStyle = \"white\";\n      roundRect(x, y, width, height, 8);\n      ctx.fill();\n\n      // ラベル\n      drawText(label, x + 15, y + 25, 12, \"#6b7280\");\n\n      // 値\n      drawText(value || \"未入力\", x + 15, y + 45, 16, \"#1f2937\", width - 30);\n    }\n\n    let currentY = 40;\n\n    // タイトル\n    drawText(\"【自己紹介カード】\", 300, currentY + 25, 32, \"#3b82f6\");\n    ctx.textAlign = \"start\";\n    currentY += 70;\n\n    // 名前\n    drawLabeledBox(320, currentY, 260, 60, \"名前（ニックネーム）\", data.name);\n    currentY += 80;\n\n    // 誕生日\n    const birthText =\n      data.birthMonth && data.birthDay\n        ? `${data.birthMonth}月 ${data.birthDay}日`\n        : \"未入力\";\n    drawLabeledBox(320, currentY, 260, 60, \"誕生日\", birthText);\n    currentY += 80;\n\n    // 学部・学年\n    drawLabeledBox(320, currentY, 125, 60, \"学部\", data.department);\n    drawLabeledBox(\n      460,\n      currentY,\n      125,\n      60,\n      \"学年\",\n      data.grade ? `${data.grade}年` : \"\"\n    );\n    currentY += 80;\n\n    // 出身・MBTI\n    drawLabeledBox(320, currentY, 125, 60, \"出身\", data.hometown);\n    drawLabeledBox(460, currentY, 125, 60, \"MBTI\", data.mbti);\n    currentY += 80;\n\n    // 最近のマイブーム・特技\n    drawLabeledBox(40, currentY, 250, 60, \"最近のマイブーム\", data.recentBoom);\n    drawLabeledBox(310, currentY, 250, 60, \"特技\", data.skill);\n    currentY += 80;\n\n    // パート・最近のニュース\n    drawLabeledBox(40, currentY, 250, 60, \"高校の部活\", data.part);\n    drawLabeledBox(310, currentY, 250, 60, \"最近のニュース\", data.recentNews);\n    currentY += 80;\n\n    // 好きなバンド・ランキング\n    drawLabeledBox(40, currentY, 250, 80, \"好きな食べ物\", data.favoriteBand);\n\n    // ランキングボックス\n    ctx.fillStyle = \"white\";\n    roundRect(310, currentY, 250, 80, 8);\n    ctx.fill();\n    drawText(\n      `${data.rankingLabel || \"ランキング\"}`,\n      325,\n      currentY + 25,\n      12,\n      \"#6b7280\"\n    );\n    drawText(`1. ${data.ranking1 || \"未入力\"}`, 325, currentY + 45, 14);\n    drawText(`2. ${data.ranking2 || \"未入力\"}`, 325, currentY + 60, 14);\n    drawText(`3. ${data.ranking3 || \"未入力\"}`, 325, currentY + 75, 14);\n    currentY += 100;\n\n    // ひとこと\n    drawLabeledBox(40, currentY, 520, 80, \"ひとこと\", data.comment);\n\n    // PNG形式で出力\n    const buffer = canvas.toBuffer(\"image/png\");\n\n    return new NextResponse(buffer, {\n      headers: {\n        \"Content-Type\": \"image/png\",\n        \"Content-Length\": buffer.length.toString(),\n      },\n    });\n  } catch (error) {\n    console.error(\"画像生成エラー:\", error);\n    return new NextResponse(\"画像生成に失敗しました\", { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}